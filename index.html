<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirect-based Google OAuth Test</title>
</head>
<body>
  <h1>Redirect-based Google OAuth Test</h1>
  <button id="signInRedirectBtn">Sign In with Redirect</button>
  <pre id="output" style="background: #f0f0f0; padding: 1em;"></pre>

  <script>
    // Replace with your own credentials:
    const CLIENT_ID = '110744525010-34st0v7r172u2uerpi2e3j1ghkk555qk.apps.googleusercontent.com';
    // Must be registered as an Authorized Redirect URI in your Google Cloud Console.
    const REDIRECT_URI = 'https://s2admincan.github.io/SESSIONS/logsession.html';
    const SCOPE = 'https://www.googleapis.com/auth/spreadsheets';

    // Function to initiate redirect-based sign-in
    function redirectSignIn() {
      const oauth2Endpoint = 'https://accounts.google.com/o/oauth2/v2/auth';
      const params = {
        client_id: CLIENT_ID,
        redirect_uri: REDIRECT_URI,
        response_type: 'token', // Implicit flow returns an access token
        scope: SCOPE,
        include_granted_scopes: 'true',
        state: 'pass-through value'
      };

      // Build the full URL for the OAuth request
      const url = oauth2Endpoint + '?' + Object.keys(params)
        .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params[k]))
        .join('&');

      // Redirect the browser to the OAuth 2.0 endpoint
      window.location.href = url;
    }

    // Attach event listener to the sign-in button
    document.getElementById('signInRedirectBtn').addEventListener('click', redirectSignIn);

    // On page load, check if there's an access token in the URL hash
    window.onload = function() {
      const output = document.getElementById('output');
      if (window.location.hash) {
        const hash = window.location.hash.substring(1); // Remove the '#'
        const params = new URLSearchParams(hash);
        if (params.has('access_token')) {
          const accessToken = params.get('access_token');
          output.textContent = 'Access token received:\n' + accessToken;
          // Optionally, remove the hash for cleaner URL display:
          window.history.replaceState({}, document.title, window.location.pathname);
        } else if (params.has('error')) {
          output.textContent = 'Error: ' + params.get('error');
        }
      } else {
        output.textContent = 'Click "Sign In with Redirect" to start OAuth flow.';
      }
    }
  </script>
</body>
</html>
