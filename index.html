<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test Google Sheets API Communication</title>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: data: https://www.gstatic.com https://apis.google.com; object-src 'none';">
</head>
<body>
  <h1>Google Sheets API Test</h1>
  <button id="testApiBtn">Test Sheets API</button>
  <pre id="output" style="background: #f0f0f0; padding: 10px;"></pre>
  
  <!-- Load the Google API client library -->
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    // Replace with your own credentials:
    const CLIENT_ID = '110744525010-34st0v7r172u2uerpi2e3j1ghkk555qk.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyBfkl02IsZznHMlkNhyqzDQr4TfUJc6-Bw';
    const SCOPE = 'https://www.googleapis.com/auth/spreadsheets';
    const SPREADSHEET_ID = '1Mj5WJU8NhcAjbvGbia3S8Uo74ng_zKo8mJSE3ANy7lM';
    // Test range to read from your sheet â€“ adjust as needed
    const TEST_RANGE = 'Sheet1!A1:Z1';

    // Initialize the Google API client
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: SCOPE,
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
      }).then(() => {
        console.log("GAPI client initialized");
        // Sign in the user (this will trigger a popup if not already signed in)
        return gapi.auth2.getAuthInstance().signIn();
      }).then(() => {
        console.log("User signed in successfully");
      }).catch((err) => {
        console.error("Error during initialization or sign-in:", err);
        document.getElementById("output").innerText = "Initialization error: " + err.error;
      });
    }

    // Function to test the Sheets API by reading a range from the spreadsheet
    function testSheetsAPI() {
      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: TEST_RANGE,
      }).then((response) => {
        console.log("Sheets API response:", response);
        document.getElementById("output").innerText = JSON.stringify(response.result, null, 2);
      }).catch((err) => {
        console.error("Error calling Sheets API:", err);
        document.getElementById("output").innerText = "Error: " + (err.result && err.result.error ? err.result.error.message : err);
      });
    }

    // Load the API client and auth2 library, then initialize the client
    gapi.load("client:auth2", initClient);

    // Add click event listener to the test button
    document.getElementById("testApiBtn").addEventListener("click", testSheetsAPI);
  </script>
</body>
</html>
